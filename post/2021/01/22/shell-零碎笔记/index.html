<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Shell 零碎笔记 - Awesome</title>
    <meta property="og:title" content="Shell 零碎笔记 - Awesome">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="官方文档: man bash, 按 /, 输入 Programmable Completion 回车
团子的小窝 - 编写 Bash 补全脚本
如何编写 bash 自动补全脚本
[&amp;hellip;] 来源: How can I check if a program exists from a Bash script?
[&amp;hellip;] 1command -v &amp;hellip;">
      <meta property="og:description" content="官方文档: man bash, 按 /, 输入 Programmable Completion 回车
团子的小窝 - 编写 Bash 补全脚本
如何编写 bash 自动补全脚本
[&amp;hellip;] 来源: How can I check if a program exists from a Bash script?
[&amp;hellip;] 1command -v &amp;hellip;">
      
    

    
    

    

    
    




    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  
  <body class="post">
    <header class="masthead">
      <h1><a href="/">Awesome</a></h1>

<p class="tagline">Suit up!</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">Home</a></li>
  
  <li><a href="/tags/">Tags</a></li>
  
  <li><a href="/about/">About</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Shell 零碎笔记</h1>

<h3>
  2021-01-22</h3>
<hr>


      </header>





<h2 id="命令补全">命令补全</h2>
<p>官方文档: <code>man bash</code>, 按 <code>/</code>, 输入 <code>Programmable Completion</code> 回车</p>
<p><a href="https://kodango.com/bash-competion-programming">团子的小窝 - 编写 Bash 补全脚本</a></p>
<p><a href="https://www.infoq.cn/article/bash-programmable-completion-tutorial">如何编写 bash 自动补全脚本</a></p>
<h2 id="检查某命令是否存在">检查某命令是否存在</h2>
<p>来源: <a href="https://stackoverflow.com/questions/592620/how-can-i-check-if-a-program-exists-from-a-bash-script">How can I check if a program exists from a Bash script?</a></p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#cb4b16">command</span> -v &lt;the_command&gt;
</span></span></code></pre></div><p>例子:</p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#859900">if</span> ! <span style="color:#cb4b16">command</span> -v COMMAND &amp;&gt; /dev/null
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#859900">then</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#cb4b16">echo</span> <span style="color:#2aa198">&#34;COMMAND could not be found&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    <span style="color:#cb4b16">exit</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#859900">fi</span>
</span></span></code></pre></div><blockquote>
<p><code>&amp;&gt;</code> 的意思可见: <a href="https://unix.stackexchange.com/questions/159513/what-are-the-shells-control-and-redirection-operators">What are the shell&rsquo;s control and redirection operators?</a> or <a href="https://serverfault.com/questions/739009/whats-the-accurate-meaning-of-exec-var-log-a-log-in-a-shell-script">What&rsquo;s the accurate meaning of “exec &amp;&gt;/var/log/a.log” in a shell script?</a></p>
</blockquote>
<h2 id="排序版本号">排序版本号</h2>
<p>使用 <code>sort</code> 命令, 配合 <code>-V</code> 选项</p>
<blockquote>
<p>-V, &ndash;version-sort</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#93a1a1;font-style:italic"># 从小到大排序</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#cb4b16">echo</span> -e <span style="color:#2aa198">&#39;1.2.100.4\n1.2.3.4\n10.1.2.3\n9.1.2.3&#39;</span> | sort -V
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#93a1a1;font-style:italic"># output</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#93a1a1;font-style:italic"># 1.2.3.4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#93a1a1;font-style:italic"># 1.2.100.4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#93a1a1;font-style:italic"># 9.1.2.3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#93a1a1;font-style:italic"># 10.1.2.3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#93a1a1;font-style:italic"># 从大到小排序</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#cb4b16">echo</span> -e <span style="color:#2aa198">&#39;1.2.100.4\n1.2.3.4\n10.1.2.3\n9.1.2.3&#39;</span> | sort -rV
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#93a1a1;font-style:italic"># output</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#93a1a1;font-style:italic"># 10.1.2.3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span><span style="color:#93a1a1;font-style:italic"># 9.1.2.3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span><span style="color:#93a1a1;font-style:italic"># 1.2.100.4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span><span style="color:#93a1a1;font-style:italic"># 1.2.3.4</span>
</span></span></code></pre></div><h2 id="检查某命令软件的是满足最低版本">检查某命令(软件)的是满足最低版本</h2>
<p>来源: <a href="https://unix.stackexchange.com/questions/285924/how-to-compare-a-programs-version-in-a-shell-script">How to compare a program&rsquo;s version in a shell script?</a></p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#93a1a1;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#93a1a1;font-style:italic"></span><span style="color:#268bd2">currentver</span>=<span style="color:#2aa198">&#34;</span><span style="color:#859900">$(</span>gcc -dumpversion<span style="color:#859900">)</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#268bd2">requiredver</span>=<span style="color:#2aa198">&#34;5.0.0&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#859900">if</span> [ <span style="color:#2aa198">&#34;</span><span style="color:#859900">$(</span><span style="color:#cb4b16">printf</span> <span style="color:#2aa198">&#39;%s\n&#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$requiredver</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$currentver</span><span style="color:#2aa198">&#34;</span> | sort -V | head -n1<span style="color:#859900">)</span><span style="color:#2aa198">&#34;</span> = <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$requiredver</span><span style="color:#2aa198">&#34;</span> ]; <span style="color:#859900">then</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>       <span style="color:#cb4b16">echo</span> <span style="color:#2aa198">&#34;Greater than or equal to </span><span style="color:#2aa198">${</span><span style="color:#268bd2">requiredver</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#859900">else</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>       <span style="color:#cb4b16">echo</span> <span style="color:#2aa198">&#34;Less than </span><span style="color:#2aa198">${</span><span style="color:#268bd2">requiredver</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span><span style="color:#859900">fi</span>
</span></span></code></pre></div><h2 id="快速复制-id_rsapub-到远程服务器">快速复制 id_rsa.pub 到远程服务器</h2>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>ssh-copy-id -i identity_file user@hostname
</span></span></code></pre></div><h2 id="快速备份某文件">快速备份某文件</h2>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>cp filename{,.bak}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#93a1a1;font-style:italic"># 等价于 cp filename filename.bak</span>
</span></span></code></pre></div><p>这里使用了 <a href="https://wangdoc.com/bash/expansion.html#%E5%A4%A7%E6%8B%AC%E5%8F%B7%E6%89%A9%E5%B1%95">Bash 的模式扩展</a></p>
<h2 id="并发">&ldquo;并发&rdquo;</h2>
<p>来源: <a href="https://stackoverflow.com/questions/24843570/concurrency-in-shell-scripts">Concurrency in Shell Scripts</a></p>
<pre tabindex="0"><code>cmd0 &amp;
cmd1 &amp;
cmd2 &amp;
wait
</code></pre><p>With no parameters it waits for all background processes to finish.</p>
<p>With a PID it waits for the specific process.</p>



  <footer>
  
  



<script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>



<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="https://github.com/csyakamoz">CsYakamoz</a> 2020</div>
  
  </footer>
  </article>
  
  </body>
</html>

